	</script>

	<link rel="stylesheet" href="viewer.css"/>
	<link rel="stylesheet" href="pivot.css"/>
	<link rel="stylesheet" href="codemirror.css"/>
	
	<script src="base64.js"></script>
	<script src="jquery-1.11.2.min.js"></script>
	<script src="dygraphs.js"></script>
	<script src="diff_match_patch.js"></script>
	<script src="alasql.js"></script>
	<script src="main.js"></script>
	<script src="pivot.js"></script>
	
  </head>

  <body onLoad="overlay()" style="width:100%; height:100%;">

<script>
//Load dim.json
var json;
json = JSON.parse(UTF8ArrToStr(base64DecToArr(dim_base64)));
tmpw = json.width / 655 / 60;
tmph = json.height / 655 / 60;

function replaceAll(str, s, r) {
	return str.split(s).join(r);
}
	
//Load the database
var tmp = UTF8ArrToStr(base64DecToArr(db_base64));
var tmp2 = dbjson_base64;

if (tmp2 != "") {
	alasql.databases = JSON.parse(tmp2);
}
alasql(tmp);

//Load config.json
json = JSON.parse(UTF8ArrToStr(base64DecToArr(json_base64)));
var width = (json.type.I.x2 - json.type.I.x1);
var height = (json.type.I.y1 - json.type.I.y2);
outw = tmpw*width;
outh = tmph*height;
var pageOverlays = [];
parse(json);
function isValidDate(d) {
  if ( Object.prototype.toString.call(d) !== "[object Date]" )
    return false;
  return !isNaN(d.getTime());
}
function parse(json) {
	page = 0;
	pageOverlay = pageOverlays[page];
	if (typeof pageOverlay == 'undefined') {
		pageOverlay = [];
		pageOverlays[page] = pageOverlay;
	}
	pageOverlay[pageOverlay.length] = json;
}

var zoomFactor = json.type.I.zoom * 1.30 * json.type.I.quality;
var rawZoomFactor = json.type.I.zoom * 1.30 * json.type.I.quality;

function display(json, page) {
	var containerOver = document.getElementById(json.name + "Big");
	var container = document.createElement('div');
	container.id = json.name;
	var style = "width:100%; height:100%;";
	page.appendChild(container);
	switch(json.type.C) {
		case "pdbf.common.LineChart":
		case "pdbf.common.BarChart":
			buildContainerChart(container, json, zoomFactor, style, containerOver, false);
			break;
		case "pdbf.common.Text":
			//DO NOTHING
			break;
		case "pdbf.common.Pivot":
			
			buildContainerPivot(container, json, zoomFactor, style, containerOver, false);
			break;
		default:
			alert("Unknown: " + json.type.C);
			break;
	}
}

function overlay() {
  	var pageNr = 0;
	for (var i = 0; i < pageOverlays[pageNr].length; ++i) {
		display(pageOverlays[pageNr][i], document.body)
	}
}
</script>

  </body>
</html>